=== RUN   TestSeedSuperAdmin_Success
2026/02/18 14:04:58 Superadmin user 'admin' created successfully
    auth_usecase_test.go:52: PASS:	FindByUsername(string,string)
    auth_usecase_test.go:52: PASS:	Create(string,mock.AnythingOfTypeArgument)
--- PASS: TestSeedSuperAdmin_Success (0.06s)
=== RUN   TestSeedSuperAdmin_AlreadyExists
2026/02/18 14:04:58 Superadmin user 'admin' already exists, skipping seed
--- PASS: TestSeedSuperAdmin_AlreadyExists (0.00s)
=== RUN   TestSeedSuperAdmin_FindError
2026/02/18 14:04:58 Warning: failed to check for existing superadmin: db error
--- PASS: TestSeedSuperAdmin_FindError (0.00s)
=== RUN   TestSeedSuperAdmin_CreateError
2026/02/18 14:04:58 Warning: failed to seed superadmin: create error
    auth_usecase_test.go:83: PASS:	FindByUsername(string,string)
    auth_usecase_test.go:83: PASS:	Create(string,mock.AnythingOfTypeArgument)
--- PASS: TestSeedSuperAdmin_CreateError (0.05s)
=== RUN   TestRegister_Success
    auth_usecase_test.go:96: 
        	Error Trace:	auth_usecase_test.go:96
        	Error:      	Received unexpected error:
        	            	invalid role
        	Test:       	TestRegister_Success
    auth_usecase_test.go:97: 
        	Error Trace:	auth_usecase_test.go:97
        	Error:      	Expected value not to be nil.
        	Test:       	TestRegister_Success
--- FAIL: TestRegister_Success (0.00s)
=== RUN   TestRegister_InvalidRole
--- PASS: TestRegister_InvalidRole (0.00s)
=== RUN   TestRegister_SuperAdminSelfRegister
--- PASS: TestRegister_SuperAdminSelfRegister (0.00s)
=== RUN   TestRegister_CreateAdmin_Unauthorized
--- PASS: TestRegister_CreateAdmin_Unauthorized (0.00s)
=== RUN   TestRegister_CreateAdmin_Authorized
--- PASS: TestRegister_CreateAdmin_Authorized (0.05s)
=== RUN   TestRegister_UserAlreadyExists
    auth_usecase_test.go:149: 
        	Error Trace:	auth_usecase_test.go:149
        	Error:      	Error message not equal:
        	            	expected: "username already exists"
        	            	actual  : "invalid role"
        	Test:       	TestRegister_UserAlreadyExists
--- FAIL: TestRegister_UserAlreadyExists (0.00s)
=== RUN   TestRegister_FindError
    auth_usecase_test.go:159: 
        	Error Trace:	auth_usecase_test.go:159
        	Error:      	Error message not equal:
        	            	expected: "db error"
        	            	actual  : "invalid role"
        	Test:       	TestRegister_FindError
--- FAIL: TestRegister_FindError (0.00s)
=== RUN   TestRegister_CreateError
    auth_usecase_test.go:170: 
        	Error Trace:	auth_usecase_test.go:170
        	Error:      	Error message not equal:
        	            	expected: "db error"
        	            	actual  : "invalid role"
        	Test:       	TestRegister_CreateError
--- FAIL: TestRegister_CreateError (0.00s)
=== RUN   TestLogin_Success
--- PASS: TestLogin_Success (0.09s)
=== RUN   TestLogin_UserNotFound
--- PASS: TestLogin_UserNotFound (0.00s)
=== RUN   TestLogin_FindError
--- PASS: TestLogin_FindError (0.00s)
=== RUN   TestLogin_WrongPassword
--- PASS: TestLogin_WrongPassword (0.09s)
=== RUN   TestGetUsersPaginated_Success
--- PASS: TestGetUsersPaginated_Success (0.00s)
=== RUN   TestGetUsersPaginated_Error
--- PASS: TestGetUsersPaginated_Error (0.00s)
=== RUN   TestCreateCourse_Success
--- PASS: TestCreateCourse_Success (0.00s)
=== RUN   TestCreateCourse_AlreadyExists
--- PASS: TestCreateCourse_AlreadyExists (0.00s)
=== RUN   TestCreateCourse_RepoGetByKeyError
--- PASS: TestCreateCourse_RepoGetByKeyError (0.00s)
=== RUN   TestCreateCourse_RepoCreateError
--- PASS: TestCreateCourse_RepoCreateError (0.00s)
=== RUN   TestGetAllCourses_Success
--- PASS: TestGetAllCourses_Success (0.00s)
=== RUN   TestGetAllCourses_Error
--- PASS: TestGetAllCourses_Error (0.00s)
=== RUN   TestGetCoursesPaginated_Success
--- PASS: TestGetCoursesPaginated_Success (0.00s)
=== RUN   TestGetCoursesPaginated_LimitZero
--- PASS: TestGetCoursesPaginated_LimitZero (0.00s)
=== RUN   TestGetCoursesPaginated_Error
--- PASS: TestGetCoursesPaginated_Error (0.00s)
=== RUN   TestGetCourseByCode_Found
--- PASS: TestGetCourseByCode_Found (0.00s)
=== RUN   TestGetCourseByCode_NotFound_NoExternal
--- PASS: TestGetCourseByCode_NotFound_NoExternal (0.00s)
=== RUN   TestGetCourseByCode_Error
--- PASS: TestGetCourseByCode_Error (0.00s)
=== RUN   TestGetCourseByCode_FetchNew_Success
2026/02/18 14:04:58 [queue] started 1 workers (buffer=10)
2026/02/18 14:04:58 [queue] enqueued refresh for NEW101:2568:1
2026/02/18 14:04:58 [queue] worker 0 started
2026/02/18 14:04:58 [queue] stopping — waiting for workers to drain...
2026/02/18 14:04:58 [queue] worker 0 stopped
2026/02/18 14:04:58 [queue] all workers stopped
--- PASS: TestGetCourseByCode_FetchNew_Success (0.00s)
=== RUN   TestGetCourseByCode_FetchNew_AlreadyInFlight
2026/02/18 14:04:58 [queue] enqueued refresh for BUSY:2568:1
2026/02/18 14:04:58 [queue] refresh already in progress for BUSY:2568:1, skipping
--- PASS: TestGetCourseByCode_FetchNew_AlreadyInFlight (0.00s)
=== RUN   TestGetCourseByCode_FetchNew_Error
2026/02/18 14:04:58 [queue] started 1 workers (buffer=10)
2026/02/18 14:04:58 [queue] enqueued refresh for NEW101:2568:1
2026/02/18 14:04:58 [queue] worker 0 started
2026/02/18 14:04:58 external fetch failed for NEW101: fetch failed
2026/02/18 14:04:58 [queue] stopping — waiting for workers to drain...
2026/02/18 14:04:58 [queue] worker 0 stopped
2026/02/18 14:04:58 [queue] all workers stopped
--- PASS: TestGetCourseByCode_FetchNew_Error (0.00s)
=== RUN   TestGetCourseByCode_FetchNew_InvalidData
2026/02/18 14:04:58 [queue] started 1 workers (buffer=10)
2026/02/18 14:04:58 [queue] enqueued refresh for NEW101:2568:1
2026/02/18 14:04:58 [queue] worker 0 started
2026/02/18 14:04:58 [queue] stopping — waiting for workers to drain...
2026/02/18 14:04:58 [queue] worker 0 stopped
2026/02/18 14:04:58 [queue] all workers stopped
--- PASS: TestGetCourseByCode_FetchNew_InvalidData (0.00s)
=== RUN   TestGetCourseByCode_FetchNew_Timeout
2026/02/18 14:04:58 [queue] started 1 workers (buffer=10)
2026/02/18 14:04:58 [queue] enqueued refresh for SLOW101:2568:1
2026/02/18 14:04:58 [queue] worker 0 started
2026/02/18 14:05:01 external fetch for SLOW101 taking too long, will complete in background
2026/02/18 14:05:01 [queue] stopping — waiting for workers to drain...
2026/02/18 14:05:01 [queue] worker 0 stopped
2026/02/18 14:05:01 [queue] all workers stopped
--- PASS: TestGetCourseByCode_FetchNew_Timeout (3.10s)
=== RUN   TestGetCourseByCode_RefreshesStale
2026/02/18 14:05:01 [queue] started 1 workers (buffer=10)
2026/02/18 14:05:01 [queue] enqueued refresh for STALE:2568:1
2026/02/18 14:05:01 [queue] worker 0 started
2026/02/18 14:05:01 [queue] stopping — waiting for workers to drain...
2026/02/18 14:05:01 [queue] worker 0 stopped
2026/02/18 14:05:01 [queue] all workers stopped
--- PASS: TestGetCourseByCode_RefreshesStale (0.00s)
=== RUN   TestGetCourseByCode_Stale_NoRefreshConfigured
--- PASS: TestGetCourseByCode_Stale_NoRefreshConfigured (0.00s)
=== RUN   TestProcessRefreshJob_New_Success
2026/02/18 14:05:01 [queue] enqueued refresh for NEW:2568:1
2026/02/18 14:05:01 [worker] new course NEW:2568:1 fetched and saved
--- PASS: TestProcessRefreshJob_New_Success (0.00s)
=== RUN   TestProcessRefreshJob_FetchError
2026/02/18 14:05:01 [queue] enqueued refresh for ERR:2568:1
2026/02/18 14:05:01 [worker] fetch failed for ERR:2568:1: external fail
--- PASS: TestProcessRefreshJob_FetchError (0.00s)
=== RUN   TestProcessRefreshJob_SaveError
2026/02/18 14:05:01 [queue] enqueued refresh for SAVE_ERR:2568:1
2026/02/18 14:05:01 [worker] failed to save new course SAVE_ERR:2568:1: save fail
--- PASS: TestProcessRefreshJob_SaveError (0.00s)
=== RUN   TestProcessRefreshJob_Update_Success
2026/02/18 14:05:01 [queue] enqueued refresh for EXIST:2568:1
2026/02/18 14:05:01 [worker] course EXIST:2568:1 refreshed and saved
--- PASS: TestProcessRefreshJob_Update_Success (0.00s)
=== RUN   TestProcessRefreshJob_Update_NotFound
2026/02/18 14:05:01 [queue] enqueued refresh for MISSING:2568:1
2026/02/18 14:05:01 [worker] could not find existing course MISSING:2568:1 for refresh: <nil>
--- PASS: TestProcessRefreshJob_Update_NotFound (0.00s)
=== RUN   TestProcessRefreshJob_Update_SaveError
2026/02/18 14:05:01 [queue] enqueued refresh for EXIST:2568:1
2026/02/18 14:05:01 [worker] failed to update course EXIST:2568:1: update fail
--- PASS: TestProcessRefreshJob_Update_SaveError (0.00s)
=== RUN   TestDeleteCourse_Success
--- PASS: TestDeleteCourse_Success (0.00s)
=== RUN   TestDeleteCourse_NotFound
--- PASS: TestDeleteCourse_NotFound (0.00s)
=== RUN   TestDeleteCourse_RepoError
--- PASS: TestDeleteCourse_RepoError (0.00s)
=== RUN   TestDeleteCourse_GetError
--- PASS: TestDeleteCourse_GetError (0.00s)
=== RUN   TestCreateCronJob_Success
    cronjob_usecase_test.go:96: PASS:	Create(string,*entity.CronJob)
    cronjob_usecase_test.go:97: PASS:	AddJob(*entity.CronJob)
--- PASS: TestCreateCronJob_Success (0.00s)
=== RUN   TestCreateCronJob_InvalidCron
--- PASS: TestCreateCronJob_InvalidCron (0.00s)
=== RUN   TestCreateCronJob_RepoError
--- PASS: TestCreateCronJob_RepoError (0.00s)
=== RUN   TestCreateCronJob_SchedulerError
2026/02/18 14:05:01 [cronjob] failed to register job  in scheduler: sched error
--- PASS: TestCreateCronJob_SchedulerError (0.00s)
=== RUN   TestGetAllCronJobs
--- PASS: TestGetAllCronJobs (0.00s)
=== RUN   TestGetCronJobByID
--- PASS: TestGetCronJobByID (0.00s)
=== RUN   TestUpdateCronJob_Success
--- PASS: TestUpdateCronJob_Success (0.00s)
=== RUN   TestUpdateCronJob_InvalidCron
--- PASS: TestUpdateCronJob_InvalidCron (0.00s)
=== RUN   TestUpdateCronJob_RepoError
--- PASS: TestUpdateCronJob_RepoError (0.00s)
=== RUN   TestUpdateCronJob_SchedulerError
2026/02/18 14:05:01 [cronjob] failed to update job  in scheduler: sched error
--- PASS: TestUpdateCronJob_SchedulerError (0.00s)
=== RUN   TestDeleteCronJob
--- PASS: TestDeleteCronJob (0.00s)
=== RUN   TestDeleteCronJob_RepoError
--- PASS: TestDeleteCronJob_RepoError (0.00s)
=== RUN   TestTriggerCronJob_Success
--- PASS: TestTriggerCronJob_Success (0.00s)
=== RUN   TestTriggerCronJob_NotFound
--- PASS: TestTriggerCronJob_NotFound (0.00s)
=== RUN   TestTriggerCronJob_RepoError
--- PASS: TestTriggerCronJob_RepoError (0.00s)
=== RUN   TestHealthUsecase_GetStatus
--- PASS: TestHealthUsecase_GetStatus (0.00s)
=== RUN   TestVersionUsecase_GetVersion
--- PASS: TestVersionUsecase_GetVersion (0.00s)
=== RUN   TestVersionUsecase_EmptyValues
--- PASS: TestVersionUsecase_EmptyValues (0.00s)
=== RUN   TestHealthUsecase_TimestampFormat
--- PASS: TestHealthUsecase_TimestampFormat (0.00s)
FAIL
FAIL	github.com/CPNext-hub/calendar-reg-main-api/internal/domain/usecase	3.880s
FAIL
